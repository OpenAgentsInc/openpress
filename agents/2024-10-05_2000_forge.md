# OpenPress.ai Forge Integration Log

## Current Status

We have successfully created a ForgeService class and a CreateForgeSite command that can create a new site on a Forge server. The next step is to set up a GitHub repo for the user and connect it to the Forge site.

## GitHub Template Creation Process

1. **Create a fresh Laravel installation locally**:
   ```bash
   laravel new openpress-template
   cd openpress-template
   ```

2. **Install and configure Breeze with Blade**:
   ```bash
   composer require laravel/breeze --dev
   php artisan breeze:install blade
   ```

3. **Make any desired opinionated changes to the structure or configuration**

4. **Initialize git repository and make initial commit**:
   ```bash
   git init
   git add .
   git commit -m "Initial commit: Fresh Laravel installation with Breeze and Blade"
   ```

5. **Create a new public repository on GitHub named "openpress-template"**

6. **Push the local repository to GitHub**:
   ```bash
   git remote add origin https://github.com/openagentsinc/openpress-template.git
   git branch -M main
   git push -u origin main
   ```

7. **On GitHub, go to the repository settings and convert it to a template repository**

## GitHub Repo Setup Speculation

1. **OpenPress.ai GitHub App**:
   - Create a GitHub App for OpenPress.ai
   - Use the app to create repositories in the OpenPress.ai organization
   - Grant users access to their specific repository

2. **Template Repository**:
   - Use the "openpress-template" repository we created as the base for new sites
   - When a user requests a new site, create a new repository from this template

3. **User Authentication**:
   - Implement GitHub OAuth to allow users to authenticate with their GitHub accounts
   - Use the obtained token to create repositories in the user's account (for self-managed option)

4. **Repository Creation Process**:
   - For OpenPress-managed: Create a new repo in the OpenPress.ai organization from the template
   - For self-managed: Create a new repo in the user's GitHub account from the template
   - The template ensures that each new repo starts with the correct Laravel structure and Breeze setup

5. **Access Control**:
   - For OpenPress-managed: Add the user as a collaborator to the created repository
   - For self-managed: The user already has full access to their own repository

## Relevant Forge API Endpoints

1. **Install New Repository**:
   - Endpoint: `POST /api/v1/servers/{serverId}/sites/{siteId}/git`
   - This will connect the GitHub repo to the Forge site

2. **Update Repository**:
   - Endpoint: `PUT /api/v1/servers/{serverId}/sites/{siteId}/git`
   - This can be used to update the repository details if needed

3. **Get Deployment Script**:
   - Endpoint: `GET /api/v1/servers/{serverId}/sites/{siteId}/deployment/script`
   - Retrieve the current deployment script

4. **Update Deployment Script**:
   - Endpoint: `PUT /api/v1/servers/{serverId}/sites/{siteId}/deployment/script`
   - Customize the deployment script if necessary

5. **Enable Quick Deploy**:
   - Endpoint: `POST /api/v1/servers/{serverId}/sites/{siteId}/deployment`
   - This will enable automatic deployments when changes are pushed to the repository

## Next Steps

1. Create the GitHub template repository as described above

2. Implement GitHub integration:
   - Create a GitHub App or implement OAuth for user authentication
   - Develop functionality to create repositories from the template (either in OpenPress.ai org or user's account)

3. Extend ForgeService:
   - Add methods for the additional Forge API endpoints (install repository, update deployment script, etc.)

4. Create a new command or service:
   - Implement the logic to create a GitHub repo from the template and connect it to the Forge site

5. Update the CreateForgeSite command:
   - Add options for self-managed vs OpenPress-managed sites
   - Integrate the GitHub repo creation and connection process

6. Develop user interface:
   - Create forms for users to input necessary information (site name, managed/self-managed preference, etc.)
   - Display site and repository information in the user dashboard

7. Implement error handling and logging:
   - Ensure robust error handling for both Forge and GitHub operations
   - Implement logging for debugging and monitoring purposes

8. Testing:
   - Write unit tests for the new GitHub integration functionality
   - Create integration tests for the entire site creation process

9. Documentation:
   - Update user documentation to explain the site creation process
   - Create developer documentation for the new classes and methods

10. Deployment process:
    - Set up the Forge deployment script to handle the Laravel application correctly
    - Ensure environment variables are properly set in Forge
    - Configure any necessary services (database, cache, etc.) in Forge

11. User onboarding:
    - Create a guide for users on how to clone and work with their new repository
    - Provide instructions on how to make changes and trigger deployments

By following these steps, we can create a seamless process for users to create sites with connected GitHub repositories based on our opinionated Laravel template, whether they choose the self-managed or OpenPress-managed option.